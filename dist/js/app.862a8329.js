(function(){"use strict";var e={2434:function(e,t,n){var o=n(6369),i=function(){var e=this;e._self._c;return e._m(0)},r=[function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("canvas",{attrs:{id:"canvas"}})])}],s=(n(3767),n(8585),n(8696),n(7658),n(9858)),a=n(7063),c=n(4161),u={name:"app",data(){return{websock:"",model4:"",playing:!1,audioCtx:"",analyser:"",frequencyData:"",o:80,then:"",v:0}},mounted(){window.PIXI=s,this.$on("start",this.getWav),(async()=>{await this.createModel(),this.createAnalyser()})(),window.onresize=()=>{this.model4.scale.set(1,1),this.model4.y=-10,this.model4.x=document.body.clientWidth/2-this.model4.width/8,this.model4.scale.set(.25,.25)}},created(){this.initWebSocket()},destroyed(){this.websock.close()},methods:{initWebSocket(){const e="ws://127.0.01:9000/live2d";this.websock=new WebSocket(e),this.websock.onmessage=this.websocketonmessage,this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onclose=this.websocketclose},websocketonmessage(e){let t=JSON.parse(e.data);this.getWav(t.voice,t.mood)},websocketonopen(){console.log("建立")},websocketonerror(){console.log("错误")},websocketclose(){console.log("关闭")},async createModel(){const e=new s.Application({view:document.getElementById("canvas"),autoStart:!0,resizeTo:window});this.model4=await a._Y.from("./model/Haru.model3.json",{autoUpdate:!0}),e.stage.addChild(this.model4),this.model4.y=-10,this.model4.x=document.body.clientWidth/2-this.model4.width/8,this.model4.scale.set(.25)},setMouthOpenY(e){e=Math.max(0,Math.min(1,e)),this.model4.internalModel.coreModel.setParameterValueById("ParamMouthOpenY",e)},createAnalyser(){this.audioCtx=new AudioContext,this.analyser=this.audioCtx.createAnalyser(),this.frequencyData=new Uint8Array(this.analyser.frequencyBinCount)},getByteFrequencyData(){return this.analyser.getByteFrequencyData(this.frequencyData),this.frequencyData},run(){if(!this.playing)return;const e=this.getByteFrequencyData(),t=[];for(var n=0;n<1e3;n+=this.o)t.push(e[n]);this.setMouthOpenY((this.arrayAdd(t)/t.length-20)/6),setTimeout(this.run,1e3/30)},arrayAdd(e){return e.reduce(((e,t)=>e+t),0)},getWav(e,t){(0,c.Z)({url:e,method:"get",responseType:"arraybuffer"}).then((e=>{const n=e.data;this.audioCtx.decodeAudioData(n,(e=>{const n=this.audioCtx.createBufferSource();n.buffer=e,n.connect(this.audioCtx.destination),n.connect(this.analyser),this.playing=!0,this.run(),this.model4.expression(t),n.start(0),n.onended=()=>{this.playing=!1,this.model4.expression(0)}}))}))}},watch:{}},d=u,l=n(1001),h=(0,l.Z)(d,i,r,!1,null,null,null),f=h.exports;o.ZP.config.productionTip=!1,navigator.mediaDevices.getUserMedia({audio:!0}),new o.ZP({render:e=>e(f),beforeCreate(){}}).$mount("#app")}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={id:o,loaded:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}n.m=e,function(){var e=[];n.O=function(t,o,i,r){if(!o){var s=1/0;for(d=0;d<e.length;d++){o=e[d][0],i=e[d][1],r=e[d][2];for(var a=!0,c=0;c<o.length;c++)(!1&r||s>=r)&&Object.keys(n.O).every((function(e){return n.O[e](o[c])}))?o.splice(c--,1):(a=!1,r<s&&(s=r));if(a){e.splice(d--,1);var u=i();void 0!==u&&(t=u)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[o,i,r]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,o){var i,r,s=o[0],a=o[1],c=o[2],u=0;if(s.some((function(t){return 0!==e[t]}))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(c)var d=c(n)}for(t&&t(o);u<s.length;u++)r=s[u],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(d)},o=self["webpackChunklive2d"]=self["webpackChunklive2d"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(2434)}));o=n.O(o)})();
//# sourceMappingURL=app.862a8329.js.map